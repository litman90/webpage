{"title":"A calorie is a calorie","markdown":{"yaml":{"title":"A calorie is a calorie","date":"2020-09-06","categories":["dataviz"]},"headingText":"data here https://ourworldindata.org/food-supply","containsRefs":false,"markdown":"\n\n```{r}\n#| label: setup\n#| include: false\nknitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)\nlibrary(tidyverse)\nlibrary(gganimate)\n```\n\n```{R}\n#| label: functions\n\nfix_area_name <- function(area){\n  case_when(area == \"United States of America\" ~ \"USA\",\n            TRUE ~ area)\n}\n\n\nfix_format <- function(df){\n  df %>%\n  pivot_longer(cols=starts_with(\"Y\"),\n               names_prefix = \"Y\",\n               names_to = \"year\") %>%\n    mutate(year = as.numeric(year)) %>%\n    # fix countries with very long names\n    mutate(Area = fix_area_name(Area))\n  \n}\n\n\nfilter_out_organizations <- function(df) {\n  organizations <- c(\n    \"World\",\n    \"Asia\", \"Europe\", \"Eastern Europe\", \"Western Europe\",\n    \"Southern Europe\", \"Northern Europe\", \"Oceania\",\n    \"Southern Asia\", \"Central Asia\",\n    \"Low Income Food Deficit Countries\",\n    \"Eastern Asia\", \"Australia & New Zealand\", \"Australia and New Zealand\",\n    \"Net Food Importing Developing Countries\",\n    \"Americas\", \"Northern America\", \"South America\", \"Central America\",\t\n    \"Africa\", \"Western Africa\", \"Eastern Africa\", \"Northern Africa\",\n    \"Middle Africa\",\n    \"Australia & New Zealand\", \"Australia and New Zealand\"\n  )\n  df %>% filter(!Area %in% organizations)\n}\n\n\n\n\n```\n\n```{r}\n#| label: read-data\n#| message: false\n#| warning: false\n# FAO http://fenixservices.fao.org/faostat/static/bulkdownloads/FoodBalanceSheetsHistoric_E_All_Data.zip\n\ndf <- read_csv(\"/home/matias/Projects/faostats/FoodBalanceSheetsHistoric_E_All_Data_NOFLAG.csv\")\n\nnew_method <- read_csv(\"/home/matias/Projects/faostats/NewFoodBalanceSheets_E_All_Data_NOFLAG.csv\")\n\n# fix format\ndf <- df %>% fix_format()\nnew_method <- fix_format(new_method)\n\n# bind them\ndf <- bind_rows(df, new_method)\n\n```\n\nThe world was a different place around 1960. But humans were humans, roughly similar to those that were alive thousands of years ago and likely, as most humans do, they needed to eat.\n\nThe good news is that we have quite some data of humans eating and we have an interminable debate over *how much* should we eat. \n\nIt all boils down to one number: **Total Calories**. They would have us believe that \"a calorie is a calorie\" and it doesn't matter where it comes from. Well, I'm not going to challenge the assumption on this blog, I'm saving that for later. But I was curious to see the evolution of this magical number across the world since around 1960. \n\nBefore we begin, I want to make some brief remarks.\n\nData from FAO can be found [here](http://fenixservices.fao.org/faostat/static/bulkdownloads/FoodBalanceSheetsHistoric_E_All_Data.zip).\n\n> **NOTE:** In this analysis, calorie data contains all what's available for consumption, including waste, which can unfortunatelly be significant. Also note that \"Calorie\" is easier to write about than kiloCalorie, which is the unit we are actually referring to.\n\n### Spagetthi Trend\n\n```{r}\n#| warning: false\n# Total Calories ----\ndf %>% \n  filter_out_organizations() %>% \n  filter(str_detect(Item, \"Grand Total\"), \n              str_detect(Element, \"Food supply\")) -> total_calories\n\n# choose some random countries\ncountries <- c(\"France\", \"USA\", \"China\")\n\nggplot(total_calories, aes(year, value, group=Area))+\n  geom_line(alpha=0.1) +\n  geom_line(data=filter(total_calories, Area %in% countries),\n            aes(year, value, group=Area, color=Area), lwd=1)+\n  ggthemes::theme_pander()+\n#stat_summary(fun= mean, geom=\"line\", col=\"red\", lwd=2)+\nlabs(title = 'The Rise of Total Calories',  \n       subtitle  = glue::glue(\"Each line is one country. Highlighted countries: \",\n                              glue::glue_collapse(countries, \", \")),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n     y = \"Calories (kcal/person/day)\",\n     x = \"\", color=\"\")+\n  scale_color_brewer(palette = \"Set1\")+\n  theme(legend.position = c(0.9, 0.1),\n        legend.background = element_rect(fill=NA)) +\n  scale_x_continuous(breaks = seq(1960,2020,10))+\n  NULL\n\n\n```\n\nThis looks mostly like an upward trend. In fact, just for fun, I am going to simplify this whole situation into the before/after scenario. The trend is so clear that I'm not going to lose too much information.\n\n```{r}\n#| warning: false\ntotal_calories %>% \n  group_by(Area) %>% \n  filter(year == last(year) | year == first(year)) %>% \n  ggplot(aes(year, value, group=Area))+\n  geom_line(alpha=0.5)+\n  ggthemes::theme_pander()+\n  labs(title = 'The Rise of Total Calories',  \n       subtitle  = \"Each line is one country.\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n     y = \"Calories (kcal/person/day)\",\n     x = \"\", color=\"\")\n\n```\n\nIn the plot above, we see that most countries increase their food supply as measured by the calories available for consumption since 1960. We can more easily observe each country's travel in the calorie spectrum in the dot plot below. An interesting thing to focus on this plot is the little amount of countries that have stayed around the dietary guidelines (1900 to 2400 kCal/day/person).\n\n```{r}\n  # Bin the last ~60 years in 2 moments\n  total_calories %>% \n    group_by(Area) %>% \n    filter(year == last(year) | year == first(year)) %>%\n    summarise(\n      before = first(value),\n      after = last(value),\n      change = after - before,\n      percent = change/before) -> country_change\n\n  country_change %>%\n  pivot_longer(c(before, after), names_to = \"moment\") %>%\n  mutate(moment = factor(moment,\n                         levels=c(\"before\", \"after\"),\n                         labels = c(\"~1960\", \"~2020\"))) %>% \n  filter(complete.cases(.)) -> country_change\n\n  country_change %>% \n  pivot_wider(names_from = moment,  values_from = value) %>% \n  ggplot(aes(`~1960`, `~2020`)) + \n  #geom_segment(aes(x=1900, xend=2400, y=1900, yend=2400), color=\"yellow\", lwd=4, alpha=0.1)+\n  #geom_segment(aes(x=1900, xend=2400, y=2000, yend=2500), color=\"yellow\", lwd=4, alpha=0.1)+\n  geom_abline(slope=1, intercept = 0, lty=2) +\n  geom_point(aes(color= `~1960` > `~2020`)) + \n  ggthemes::theme_pander()+  \n  theme(legend.position = \"bottom\",\n        legend.background = element_rect(fill = NA, color=\"black\"))+\n  scale_color_manual(name = \"Calories\",\n                     labels = c(\"Increased\", \"Decreased\"),\n                     values = c(\"orange\", \"black\"))+\n  labs(title = \"Countries' Total Calories Increase\",\n       subtitle = \"Each dot is one country.\",\n       x=\"Total Calories circa 1960\",\n       y=\"Total Calories circa 2020\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\")\n\n\n```\n\n\n### How much of an increase\n\nWhen we look at the calorie increase as a proportion of the original available, we see most countries increasing calories between 5% and 25%, with a good number of countries increasing heavily, even doubling their calories.  \n\n```{r}\nggplot(country_change %>% filter(moment == \"~1960\"),\n       aes(percent)) +\n  geom_histogram(binwidth = 0.05, color=\"black\", fill=\"#F53838\") +\n  scale_x_continuous(\n    breaks = seq(-0.2,1.20,0.20),\n    labels = scales::label_percent()\n    )+\n  labs(title = \"Countries' Total Calories Increase\",\n       subtitle = \"Calorie change from ~1960 to ~2020 as percentage increase from ~1960\",\n       y=\"Number of Countries\", x=\"1960-2020 Calorie increase\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\") +\n  ggthemes::theme_pander()\n\n```\n\nCan you make it move? Yes! To nail the point home, I want to add some motion to the plots, to see the World's constant move into higher and higher calorie values. Surprisingly, we don't see the world moving above 2000 calories and narrowing the distribution into an efficent \"Enough food for everyone without waste\" stage. We see this terrifying amoeba-like distribution creep into higher and higher caloric values.\n\n```{r}\n#| label: density-gif\n#| eval: false\n#| warning: false\n# check here https://github.com/thomasp85/gganimate/wiki/Temperature-time-series\nlibrary(RColorBrewer)\nred_pal <- colorRampPalette(brewer.pal(9, \"Reds\"))(length(unique(df$year)))\n\n# Total calories density ----\nggplot(total_calories, aes(value))+\n  #geom_histogram()+\n  geom_density(aes(value, fill=factor(year)))+\n  scale_fill_manual(values = red_pal)+\n  theme(legend.position = \"none\",\n        axis.line.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        axis.text.y = element_blank(),\n        axis.line.x=element_line(color=\"black\", size = 2),\n        axis.text.x = element_text(size=16),\n        panel.background = element_blank(),\n        panel.grid = element_blank())+\n  xlim(c(1000,4200))+\n  transition_states(year) +\n  shadow_trail(distance = 1, fill=NA, color=\"black\")+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state}\"),  \n       subtitle  =  paste(\"Distribution of food available for consumption (kcal/capita/day).\"),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       y=\"\", x=\"Calories (kcal/person/day)\") -> anim_density\n\nanimate(\n  plot = anim_density, \n  nframes = length(unique(total_calories$year)), \n  detail = 8,\n  fps = 4, height = 4, width = 6, units = \"in\", res = 150,\n  end_pause = 8\n)\nanim_save(\"calorie_density.gif\")\n```\n\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">Feel the excess calories creeping in? It&#39;s not just you it&#39;s <a href=\"https://twitter.com/hashtag/worldwide?src=hash&amp;ref_src=twsrc%5Etfw\">#worldwide</a> <a href=\"https://t.co/NILcKc9vDg\">pic.twitter.com/NILcKc9vDg</a></p>&mdash; Matias Andina (@NeuroMLA) <a href=\"https://twitter.com/NeuroMLA/status/1302668758125875203?ref_src=twsrc%5Etfw\">September 6, 2020</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\nI found this *waterfall (?)* plot to be also quite telling about the overall movement by decade. \n\n```{r}\n# Animate this\nfloor_decade    = function(value){ return(value - value %% 10) }\n\nggplot(total_calories %>% mutate(decade = floor_decade(year)),\n       aes(x = year, value)) +\n  geom_point(alpha=0.5)+\n  coord_flip()+\n  scale_x_reverse()+\n  transition_states(decade)+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state} decade\"),  \n       subtitle = \"Each dot is one country\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       x=\"\", y=\"Calories (kcal/person/day)\") +\n  scale_y_continuous(breaks=seq(1500, 4000, 500)) +\n  ggthemes::theme_pander() -> waterfall\n\nanimate(\n  plot = waterfall, \n  detail = 8,  height = 4, width = 6, units = \"in\", res = 150,\n)\n# anim_save(\"waterfall.gif\")\n```\n\n\n### The good and the Bad\n\nGood news is we lifted an incredible amount of people out of poverty. With that, we see the daily available calories in all countries go up above a somewhat arbitrary 2000 Calories/day/person. The bad news, is that  \n\n\n```{r}\n#| label: points-going-up\nggplot(total_calories,\n       aes(x = as.numeric(factor(Area)),\n           value, color = value>2000)) +\n  geom_hline(yintercept = 2000)+\n  geom_point(size=2, alpha=0.5)+\n  scale_color_manual(values=c(\"black\", \"orange\"))+\n  ggthemes::theme_pander()+\n  theme(legend.position = \"none\", axis.text.x = element_blank())+\n  transition_states(year) +\n  #shadow_trail(distance = 1, fill=NA, color=\"black\")+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state}\"),  \n       subtitle  =  paste(\"Food available for consumption not accounting for waste (kcal/capita/day).\\nEach dot is one country.\"),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       x=\"Country (unranked)\", y=\"Calories (kcal/person/day)\") -> points_going_up\n\n\nanimate(\n  #filename = \"points_going_up.gif\",\n  plot = points_going_up, \n  nframes = length(unique(total_calories$year)), \n  detail = 8, height = 4, width = 6, units = \"in\", res = 150,\n  fps = 4,\n  end_pause = 8\n)\n#anim_save(\"points_going_up.gif\")\n```\n\nCalories are just the tip of the iceberg. If you want to see analysis at the macro levels, check my post about cereals.  \n","srcMarkdownNoYaml":"\n\n```{r}\n#| label: setup\n#| include: false\nknitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)\nlibrary(tidyverse)\nlibrary(gganimate)\n```\n\n```{R}\n#| label: functions\n\nfix_area_name <- function(area){\n  case_when(area == \"United States of America\" ~ \"USA\",\n            TRUE ~ area)\n}\n\n\nfix_format <- function(df){\n  df %>%\n  pivot_longer(cols=starts_with(\"Y\"),\n               names_prefix = \"Y\",\n               names_to = \"year\") %>%\n    mutate(year = as.numeric(year)) %>%\n    # fix countries with very long names\n    mutate(Area = fix_area_name(Area))\n  \n}\n\n\nfilter_out_organizations <- function(df) {\n  organizations <- c(\n    \"World\",\n    \"Asia\", \"Europe\", \"Eastern Europe\", \"Western Europe\",\n    \"Southern Europe\", \"Northern Europe\", \"Oceania\",\n    \"Southern Asia\", \"Central Asia\",\n    \"Low Income Food Deficit Countries\",\n    \"Eastern Asia\", \"Australia & New Zealand\", \"Australia and New Zealand\",\n    \"Net Food Importing Developing Countries\",\n    \"Americas\", \"Northern America\", \"South America\", \"Central America\",\t\n    \"Africa\", \"Western Africa\", \"Eastern Africa\", \"Northern Africa\",\n    \"Middle Africa\",\n    \"Australia & New Zealand\", \"Australia and New Zealand\"\n  )\n  df %>% filter(!Area %in% organizations)\n}\n\n\n\n\n```\n\n```{r}\n#| label: read-data\n#| message: false\n#| warning: false\n# data here https://ourworldindata.org/food-supply\n# FAO http://fenixservices.fao.org/faostat/static/bulkdownloads/FoodBalanceSheetsHistoric_E_All_Data.zip\n\ndf <- read_csv(\"/home/matias/Projects/faostats/FoodBalanceSheetsHistoric_E_All_Data_NOFLAG.csv\")\n\nnew_method <- read_csv(\"/home/matias/Projects/faostats/NewFoodBalanceSheets_E_All_Data_NOFLAG.csv\")\n\n# fix format\ndf <- df %>% fix_format()\nnew_method <- fix_format(new_method)\n\n# bind them\ndf <- bind_rows(df, new_method)\n\n```\n\nThe world was a different place around 1960. But humans were humans, roughly similar to those that were alive thousands of years ago and likely, as most humans do, they needed to eat.\n\nThe good news is that we have quite some data of humans eating and we have an interminable debate over *how much* should we eat. \n\nIt all boils down to one number: **Total Calories**. They would have us believe that \"a calorie is a calorie\" and it doesn't matter where it comes from. Well, I'm not going to challenge the assumption on this blog, I'm saving that for later. But I was curious to see the evolution of this magical number across the world since around 1960. \n\nBefore we begin, I want to make some brief remarks.\n\nData from FAO can be found [here](http://fenixservices.fao.org/faostat/static/bulkdownloads/FoodBalanceSheetsHistoric_E_All_Data.zip).\n\n> **NOTE:** In this analysis, calorie data contains all what's available for consumption, including waste, which can unfortunatelly be significant. Also note that \"Calorie\" is easier to write about than kiloCalorie, which is the unit we are actually referring to.\n\n### Spagetthi Trend\n\n```{r}\n#| warning: false\n# Total Calories ----\ndf %>% \n  filter_out_organizations() %>% \n  filter(str_detect(Item, \"Grand Total\"), \n              str_detect(Element, \"Food supply\")) -> total_calories\n\n# choose some random countries\ncountries <- c(\"France\", \"USA\", \"China\")\n\nggplot(total_calories, aes(year, value, group=Area))+\n  geom_line(alpha=0.1) +\n  geom_line(data=filter(total_calories, Area %in% countries),\n            aes(year, value, group=Area, color=Area), lwd=1)+\n  ggthemes::theme_pander()+\n#stat_summary(fun= mean, geom=\"line\", col=\"red\", lwd=2)+\nlabs(title = 'The Rise of Total Calories',  \n       subtitle  = glue::glue(\"Each line is one country. Highlighted countries: \",\n                              glue::glue_collapse(countries, \", \")),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n     y = \"Calories (kcal/person/day)\",\n     x = \"\", color=\"\")+\n  scale_color_brewer(palette = \"Set1\")+\n  theme(legend.position = c(0.9, 0.1),\n        legend.background = element_rect(fill=NA)) +\n  scale_x_continuous(breaks = seq(1960,2020,10))+\n  NULL\n\n\n```\n\nThis looks mostly like an upward trend. In fact, just for fun, I am going to simplify this whole situation into the before/after scenario. The trend is so clear that I'm not going to lose too much information.\n\n```{r}\n#| warning: false\ntotal_calories %>% \n  group_by(Area) %>% \n  filter(year == last(year) | year == first(year)) %>% \n  ggplot(aes(year, value, group=Area))+\n  geom_line(alpha=0.5)+\n  ggthemes::theme_pander()+\n  labs(title = 'The Rise of Total Calories',  \n       subtitle  = \"Each line is one country.\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n     y = \"Calories (kcal/person/day)\",\n     x = \"\", color=\"\")\n\n```\n\nIn the plot above, we see that most countries increase their food supply as measured by the calories available for consumption since 1960. We can more easily observe each country's travel in the calorie spectrum in the dot plot below. An interesting thing to focus on this plot is the little amount of countries that have stayed around the dietary guidelines (1900 to 2400 kCal/day/person).\n\n```{r}\n  # Bin the last ~60 years in 2 moments\n  total_calories %>% \n    group_by(Area) %>% \n    filter(year == last(year) | year == first(year)) %>%\n    summarise(\n      before = first(value),\n      after = last(value),\n      change = after - before,\n      percent = change/before) -> country_change\n\n  country_change %>%\n  pivot_longer(c(before, after), names_to = \"moment\") %>%\n  mutate(moment = factor(moment,\n                         levels=c(\"before\", \"after\"),\n                         labels = c(\"~1960\", \"~2020\"))) %>% \n  filter(complete.cases(.)) -> country_change\n\n  country_change %>% \n  pivot_wider(names_from = moment,  values_from = value) %>% \n  ggplot(aes(`~1960`, `~2020`)) + \n  #geom_segment(aes(x=1900, xend=2400, y=1900, yend=2400), color=\"yellow\", lwd=4, alpha=0.1)+\n  #geom_segment(aes(x=1900, xend=2400, y=2000, yend=2500), color=\"yellow\", lwd=4, alpha=0.1)+\n  geom_abline(slope=1, intercept = 0, lty=2) +\n  geom_point(aes(color= `~1960` > `~2020`)) + \n  ggthemes::theme_pander()+  \n  theme(legend.position = \"bottom\",\n        legend.background = element_rect(fill = NA, color=\"black\"))+\n  scale_color_manual(name = \"Calories\",\n                     labels = c(\"Increased\", \"Decreased\"),\n                     values = c(\"orange\", \"black\"))+\n  labs(title = \"Countries' Total Calories Increase\",\n       subtitle = \"Each dot is one country.\",\n       x=\"Total Calories circa 1960\",\n       y=\"Total Calories circa 2020\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\")\n\n\n```\n\n\n### How much of an increase\n\nWhen we look at the calorie increase as a proportion of the original available, we see most countries increasing calories between 5% and 25%, with a good number of countries increasing heavily, even doubling their calories.  \n\n```{r}\nggplot(country_change %>% filter(moment == \"~1960\"),\n       aes(percent)) +\n  geom_histogram(binwidth = 0.05, color=\"black\", fill=\"#F53838\") +\n  scale_x_continuous(\n    breaks = seq(-0.2,1.20,0.20),\n    labels = scales::label_percent()\n    )+\n  labs(title = \"Countries' Total Calories Increase\",\n       subtitle = \"Calorie change from ~1960 to ~2020 as percentage increase from ~1960\",\n       y=\"Number of Countries\", x=\"1960-2020 Calorie increase\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\") +\n  ggthemes::theme_pander()\n\n```\n\nCan you make it move? Yes! To nail the point home, I want to add some motion to the plots, to see the World's constant move into higher and higher calorie values. Surprisingly, we don't see the world moving above 2000 calories and narrowing the distribution into an efficent \"Enough food for everyone without waste\" stage. We see this terrifying amoeba-like distribution creep into higher and higher caloric values.\n\n```{r}\n#| label: density-gif\n#| eval: false\n#| warning: false\n# check here https://github.com/thomasp85/gganimate/wiki/Temperature-time-series\nlibrary(RColorBrewer)\nred_pal <- colorRampPalette(brewer.pal(9, \"Reds\"))(length(unique(df$year)))\n\n# Total calories density ----\nggplot(total_calories, aes(value))+\n  #geom_histogram()+\n  geom_density(aes(value, fill=factor(year)))+\n  scale_fill_manual(values = red_pal)+\n  theme(legend.position = \"none\",\n        axis.line.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        axis.text.y = element_blank(),\n        axis.line.x=element_line(color=\"black\", size = 2),\n        axis.text.x = element_text(size=16),\n        panel.background = element_blank(),\n        panel.grid = element_blank())+\n  xlim(c(1000,4200))+\n  transition_states(year) +\n  shadow_trail(distance = 1, fill=NA, color=\"black\")+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state}\"),  \n       subtitle  =  paste(\"Distribution of food available for consumption (kcal/capita/day).\"),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       y=\"\", x=\"Calories (kcal/person/day)\") -> anim_density\n\nanimate(\n  plot = anim_density, \n  nframes = length(unique(total_calories$year)), \n  detail = 8,\n  fps = 4, height = 4, width = 6, units = \"in\", res = 150,\n  end_pause = 8\n)\nanim_save(\"calorie_density.gif\")\n```\n\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">Feel the excess calories creeping in? It&#39;s not just you it&#39;s <a href=\"https://twitter.com/hashtag/worldwide?src=hash&amp;ref_src=twsrc%5Etfw\">#worldwide</a> <a href=\"https://t.co/NILcKc9vDg\">pic.twitter.com/NILcKc9vDg</a></p>&mdash; Matias Andina (@NeuroMLA) <a href=\"https://twitter.com/NeuroMLA/status/1302668758125875203?ref_src=twsrc%5Etfw\">September 6, 2020</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\nI found this *waterfall (?)* plot to be also quite telling about the overall movement by decade. \n\n```{r}\n# Animate this\nfloor_decade    = function(value){ return(value - value %% 10) }\n\nggplot(total_calories %>% mutate(decade = floor_decade(year)),\n       aes(x = year, value)) +\n  geom_point(alpha=0.5)+\n  coord_flip()+\n  scale_x_reverse()+\n  transition_states(decade)+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state} decade\"),  \n       subtitle = \"Each dot is one country\",\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       x=\"\", y=\"Calories (kcal/person/day)\") +\n  scale_y_continuous(breaks=seq(1500, 4000, 500)) +\n  ggthemes::theme_pander() -> waterfall\n\nanimate(\n  plot = waterfall, \n  detail = 8,  height = 4, width = 6, units = \"in\", res = 150,\n)\n# anim_save(\"waterfall.gif\")\n```\n\n\n### The good and the Bad\n\nGood news is we lifted an incredible amount of people out of poverty. With that, we see the daily available calories in all countries go up above a somewhat arbitrary 2000 Calories/day/person. The bad news, is that  \n\n\n```{r}\n#| label: points-going-up\nggplot(total_calories,\n       aes(x = as.numeric(factor(Area)),\n           value, color = value>2000)) +\n  geom_hline(yintercept = 2000)+\n  geom_point(size=2, alpha=0.5)+\n  scale_color_manual(values=c(\"black\", \"orange\"))+\n  ggthemes::theme_pander()+\n  theme(legend.position = \"none\", axis.text.x = element_blank())+\n  transition_states(year) +\n  #shadow_trail(distance = 1, fill=NA, color=\"black\")+\n  labs(title = paste(\"World's Daily Caloric Supply in {closest_state}\"),  \n       subtitle  =  paste(\"Food available for consumption not accounting for waste (kcal/capita/day).\\nEach dot is one country.\"),\n       caption  = \"DataViz: @NeuroMLA | Data Source: FAO\",\n       x=\"Country (unranked)\", y=\"Calories (kcal/person/day)\") -> points_going_up\n\n\nanimate(\n  #filename = \"points_going_up.gif\",\n  plot = points_going_up, \n  nframes = length(unique(total_calories$year)), \n  detail = 8, height = 4, width = 6, units = \"in\", res = 150,\n  fps = 4,\n  end_pause = 8\n)\n#anim_save(\"points_going_up.gif\")\n```\n\nCalories are just the tip of the iceberg. If you want to see analysis at the macro levels, check my post about cereals.  \n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"filters":["social-embeds","social-share"],"include-after-body":["../../footer.html"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.433","editor":"visual","comments":{"utterances":{"repo":"matiasandina/Webpage","label":"Comment","theme":"github-dark"}},"theme":{"light":["flatly","../../theme.scss"],"dark":["darkly","../../dark.scss"]},"code-copy":true,"grid":{"body-width":"900px","margin-width":"300px","gutter-width":"1.5rem"},"title-block-banner":true,"license":"CC BY","toc-title":"Table of contents","toc-location":"right","author":[{"name":"Matias Andina","url":"https://matiasandina.netlify.app","affiliation":"Massachusetts Institute of Technology","orcid":"0000-0002-1996-2539"}],"citation":true,"share":{"permalink":"https://matiasandina.netlify.app/","description":"Matias Andina","twitter":true,"facebook":true,"reddit":true,"stumble":true,"tumblr":false,"linkedin":true,"email":true,"mastodon":true},"title":"A calorie is a calorie","date":"2020-09-06","categories":["dataviz"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}