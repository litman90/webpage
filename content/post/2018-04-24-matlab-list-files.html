---
title: "Matlab list_files"
author: "Matias Andina"
date: 2018-04-24
output: html_document
tags: ["learning", "ideas", "R", "Matlab"]
---



<p>For many purposes, I find myself in need of a Graphical User Interface (GUI). Thus, I experienced a forceful transition to Matlab. Let’s be honest, Matlab can do powerful things, it’s a great language to attempt to dominate (note to self: learn python!). However, I find myself over and over thinking in <code>R</code> mode. Something along the lines of:</p>
<blockquote>
<p>Gimme all the files in…</p>
</blockquote>
<p>Will be easily accomplished in <code>R</code></p>
<pre class="r"><code>list.files(...)</code></pre>
<p>This command can handle many many options, with <code>pattern</code> being among my favorite. More importantly, this command returns a useful <code>character</code> vector. No extra dots, no list of lists, no array. Just, useful. On the other hand, Matlab has <code>dir</code> and <code>ls</code> both of which are not satisfactory.</p>
<pre class="octave"><code>dir

.                                                      
..                                    
something.m                            
something_else.m                               
LookHere.m
</code></pre>
<p>Yes…Matlab’s version can also handle some form of regular expression matching. But, mind the dots and the structure! Matlab’s <code>dir</code> has a ton of things on it.</p>
<pre class="octave"><code>&gt;&gt; q = dir

q = 

  20×1 struct array with fields:

    name
    folder
    date
    bytes
    isdir
    datenum</code></pre>
<p>Matlab <code>ls</code> function is also full of deadly traps.</p>
<pre class="octave"><code>qq = ls

qq =

  20×28 char array

    &#39;.                           &#39;
    &#39;..                          &#39;
    &#39;many_things_here.ext        &#39;
</code></pre>
<div id="the-solution" class="section level2">
<h2>The solution</h2>
<p>I found myself fighting for a character vector or array (<code>nx1</code>) I can feed into a function/loop/whatever.</p>
<p>So after many many many times fighting against classes, with functions that expect <code>char</code> instead of <code>string</code>, or <code>cell</code>, or <code>whatever</code>, I decided to create something that resembles (at least partially) the functionality I was looking for. It’s not perfect, in fact, please enlighten me with a better approach. For now, I will be using <code>list_files.m</code>. Wanna use it? Be my guest, see below:</p>
<pre class="octave"><code>
% The idea of this function is to have something that works to list files
% Matlab has too many weird things with dir/patterns/etc...
% It could be slow if calling in a BIG dir and then subsetting
% Otherwise it should work pretty fast

function filenames = list_files(varargin)

% Open input parser
p = inputParser();

% Add possible values
addOptional(p, &#39;Interactive&#39;, true, @islogical)
addOptional(p, &#39;Dirname&#39;, &#39;0&#39;, @ischar)
addOptional(p, &#39;Pattern&#39;, {&#39;.&#39;}, @iscell)
addOptional(p, &#39;FullPath&#39;, false, @islogical)


% parse
parse(p, varargin{:});

% retrieve things from parser
Interactive = p.Results.Interactive;
Dirname = p.Results.Dirname;
Pattern = p.Results.Pattern;
FullPath = p.Results.FullPath;


%% Dirname goes first
% If we didn&#39;t provide a Dirname, both defaults will hold
% If we provided a Dirname, we will read from there

if (Interactive &amp;&amp; string(Dirname) == &#39;0&#39;)

    dirname = uigetdir();

else
    
    dirname = Dirname;
    
end


if ~isdir(dirname)
    error(&#39;Dirname not valid, check dirname provided is character and exists.&#39;)
end

% actually call dir
    d=dir(dirname);
% Remove the dots matlab puts to things
    d=d(~ismember({d.name},{&#39;.&#39;,&#39;..&#39;}));

    % Get filenames
    % Output as an mx1 cell
    
    filenames = {d.name}&#39;;

        
%% Subset by pattern
    
    default_pattern = string(Pattern) == &#39;.&#39;;

    if (~default_pattern) % non default case
    
    % join cell patterns separated by the &#39;or&#39; regular expression
    query_expression = strjoin(Pattern, &#39;|&#39;);
    
    %  Subset the patterns
    filenames = filenames(~cellfun(@isempty,regexp(filenames, query_expression)));
    end
    
    % By default we return just the name
    % If you want the full path, call it!
    % it currently works only for 1 folder
    % Recursive = TRUE will be super nice!
    
    if FullPath
    filenames = fullfile(unique({d.folder}), filenames);
    end
end
</code></pre>
</div>
