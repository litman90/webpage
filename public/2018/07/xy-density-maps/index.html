<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>XY-density-maps</title>
  <meta property="og:title" content="XY-density-maps" />
  <meta name="twitter:title" content="XY-density-maps" />
  <meta name="description" content="I have been playing around with tracking software and the ways to visualize the position of an animal in an arena over time. Even with normal cameras (30 Hz) and relatively small periods of time (~5 min) we get massive datasets and the only way to make sense of them is to aggregate data over time. I have been interested in neat visualizations (using R), thus here are some ways/comments. I will explore different packages and doing comparisons of the results.">
  <meta property="og:description" content="I have been playing around with tracking software and the ways to visualize the position of an animal in an arena over time. Even with normal cameras (30 Hz) and relatively small periods of time (~5 min) we get massive datasets and the only way to make sense of them is to aggregate data over time. I have been interested in neat visualizations (using R), thus here are some ways/comments. I will explore different packages and doing comparisons of the results.">
  <meta name="twitter:description" content="I have been playing around with tracking software and the ways to visualize the position of an animal in an arena over time. Even with normal cameras (30 Hz) and relatively small periods of time (~5 â€¦">
  <meta name="author" content="Matias Andina"/>
  <link href='/img/webpage_logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="/img/m-gray.jpg" />
  <meta name="twitter:image" content="/img/m-gray.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@NeuroMLA" />
  <meta name="twitter:creator" content="@NeuroMLA" />
  <meta property="og:url" content="/2018/07/xy-density-maps/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Matias Andina" />

  <meta name="generator" content="Hugo 0.30.2" />
  <link rel="canonical" href="/2018/07/xy-density-maps/" />
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Matias Andina">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="/css/syntax.css" /><link rel="stylesheet" href="/css/codeblock.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Matias Andina</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Research</a>
              <div class="navlinks-children">
                
                  <a href="/page/Learning-and-Memory">Learning and Memory</a>
                
                  <a href="/page/Maternal-Behavior">Maternal Behavior</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="Teaching" href="/page/teaching/">Teaching</a>
            </li>
          
        
          
            <li>
              <a title="Blog" href="/post/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Matias Andina" href="/">
            <img class="avatar-img" src="/img/m-gray.jpg" alt="Matias Andina" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>XY-density-maps</h1>
                
                
                  <span class="post-meta">
  
  
  <i class="fa fa-calendar-o"></i>&nbsp;Posted on July 13, 2018
  
  
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>I have been playing around with tracking software and the ways to visualize the position of an animal in an arena over time. Even with normal cameras (30 Hz) and relatively small periods of time (~5 min) we get massive datasets and the only way to make sense of them is to aggregate data over time. I have been interested in neat visualizations (using R), thus here are some ways/comments. I will explore different packages and doing comparisons of the results.</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<pre class="r"><code>suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(RColorBrewer))
suppressPackageStartupMessages(library(KernSmooth))
suppressPackageStartupMessages(library(raster))
suppressPackageStartupMessages(library(gplots))
suppressPackageStartupMessages(library(ggplot2))</code></pre>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>I have an example dataset with <code>XY</code> position of the animal. I also have other morphological data that is irrelevant for this case. See example below:</p>
<pre><code>##          X        Y Orientation MinorAxis MajorAxis
## 1 325.5522 158.9700   -1.550285  50.47925  130.5679
## 2 323.3055 156.6896   -1.569706  51.29840  130.3467
## 3 321.7411 154.8107    1.545683  52.13492  130.3881
## 4 320.8373 153.3294    1.512549  52.67011  130.6403
## 5 320.0381 152.5523    1.477299  53.07783  130.1023
## 6 319.3961 152.2019    1.439171  53.75891  129.6706</code></pre>
<p>I will do some setup that is common for all the graphs (aka, color palette and the dimensions of the arena).</p>
<pre class="r"><code># Get color palette 

refCol &lt;- colorRampPalette(rev(brewer.pal(6,&#39;Spectral&#39;)))
mycol &lt;- refCol(6)

# define bin sizes
bin_size &lt;- 40

# Camera resolution is 640x480. Hence...
xbins &lt;- 640/bin_size 
ybins &lt;- 480/bin_size</code></pre>
</div>
<div id="ggplot2" class="section level2">
<h2>ggplot2</h2>
<p>The reason I always go to <code>ggplot2</code> first is because itâ€™s awesome, I buy into the grammar and find it intuitive to accumulate layers over layers. The underlying thought is that <code>ggplot2</code> handles all problems. In this case the result has some pros (layers, layers and more layer), and some cons (basically, it doesnâ€™t look amazing).</p>
<pre class="r"><code>p &lt;- ggplot(rat_pos, aes(X,Y)) +
  stat_density2d(geom = &#39;tile&#39;, aes(fill = ..density..), contour = FALSE,
                 n = c(xbins, ybins)) +
  #geom_point() + 
  #geom_path(alpha=0.1) +
  coord_equal() +
  theme_minimal() +
  scale_fill_gradientn(colors =  mycol) +
  geom_vline(xintercept = c(0,640))+
  geom_hline(yintercept = c(0,480))

print(p)</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/ggplot2-option-1-1.png" width="672" /></p>
<p>This is interesting because we can overlay things into the plot. For example the trace:</p>
<pre class="r"><code>p + geom_path(alpha=0.1)</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/ggplot2-option-1-trace-1.png" width="672" /></p>
<p>We can further remove the axis (or any other modifications we feel like doing).</p>
<pre class="r"><code>p + geom_path(alpha=0.5) + theme_void()</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/ggplot2-option-1-noborder-1.png" width="672" /></p>
<p>I found that, if we calculate the density externally, it looks smoother. This is a mixed, <code>bkde2D</code> mediated, <code>ggplot2</code> approach (aka the best of 2 worlds).</p>
<pre class="r"><code>bins &lt;- bkde2D(as.matrix(rat_pos[,1:2]), bandwidth = c(xbins, ybins),
               gridsize = c(640L, 480L))

bins_to_plot &lt;- melt(bins$fhat)


ggplot(bins_to_plot, aes(Var1, Var2, fill = value)) +
  geom_raster()+
  coord_equal() +
  theme_minimal() +
  scale_fill_gradientn(colors =  mycol) +
  geom_vline(xintercept = c(0,640))+
  geom_hline(yintercept = c(0,480))+
  theme_void()</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/ggplot2-option-2-1.png" width="672" /></p>
</div>
<div id="using-raster-package" class="section level2">
<h2>Using raster package</h2>
<p>Raster package is maybe an older solution, which is surprisingly low demand. In 3 code lines we get a perfectly functional plot. On the other hand, itâ€™s not the best looking graph and we get the caveats (yes, <code>base</code> graphics).</p>
<pre class="r"><code>r &lt;- raster(xmn=0, ymn=0, xmx=640, ymx=480, res=20)
x &lt;- rasterize(rat_pos[,1:2], r, fun=&#39;count&#39;)
plot(x, xlim=c(0,640), ylim=c(0,480), xaxt=&#39;n&#39;, ann=FALSE, yaxt=&#39;n&#39;)</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/raster-package-1.png" width="672" /></p>
</div>
<div id="using-gplots-package" class="section level1">
<h1>Using gplots package</h1>
<p>This package produces a nice plot. I must confess I did not look to much into it because itâ€™s really similar to what <code>ggplot2</code> can do with tiles. I was biased towards a smoother version of the world.</p>
<pre class="r"><code># create plot
q &lt;- hist2d(rat_pos[,1:2], same.scale=TRUE,
       nbins=c(xbins, ybins),
       col = mycol, xaxt=&#39;n&#39;, ann=FALSE, yaxt=&#39;n&#39;)</code></pre>
<p><img src="/post/2018-07-13-XY-density-maps_files/figure-html/gplots-package-1.png" width="672" /></p>
<div id="documentation" class="section level2">
<h2>Documentation</h2>
<p>I have found a good amount of advice and inspiration in the links below.</p>
<ul>
<li><a href="http://stat405.had.co.nz/ggmap.pdf" class="uri">http://stat405.had.co.nz/ggmap.pdf</a></li>
<li><a href="https://stackoverflow.com/questions/24078774/overlay-two-ggplot2-stat-density2d-plots-with-alpha-channels?lq=1" class="uri">https://stackoverflow.com/questions/24078774/overlay-two-ggplot2-stat-density2d-plots-with-alpha-channels?lq=1</a></li>
<li><a href="https://www.r-bloggers.com/5-ways-to-do-2d-histograms-in-r/" class="uri">https://www.r-bloggers.com/5-ways-to-do-2d-histograms-in-r/</a></li>
<li><a href="https://stackoverflow.com/questions/24845652/specifying-the-scale-for-the-density-in-ggplot2s-stat-density2d" class="uri">https://stackoverflow.com/questions/24845652/specifying-the-scale-for-the-density-in-ggplot2s-stat-density2d</a></li>
</ul>
</div>
</div>

      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="/2018/05/github-style-calendar-heatmaps/" data-toggle="tooltip" data-placement="top" title="Github style calendar heatmaps">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="/2018/08/writing-challenge-day-1/" data-toggle="tooltip" data-placement="top" title="Writing challenge Day 1">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:matiasandina@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/matiasandina" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/NeuroMLA" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/matias-andina-58a0a4b5" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="yourwebsite.com">Matias Andina</a>
            
          

          &nbsp;&bull;&nbsp;
          2019

          
            &nbsp;&bull;&nbsp;
            <a href="/">Matias Andina</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.30.2</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/js/main.js"></script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="/js/load-photoswipe.js"></script>






  </body>
</html>

